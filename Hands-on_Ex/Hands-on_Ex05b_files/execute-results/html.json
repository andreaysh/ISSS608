{
  "hash": "6d2ba3c5a3c1f56528e0a865b16751e1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hands-on Exercise 05b\"\nauthor: \"Andrea Yeo\"\ndate-modified: \"last-modified\"\nexecute:\n  echo: true\n  eval: true\n  warning: false\n  freeze: true\n---\n\n\n\n[With the assistance of ChatGPT]{style=\"font-size: 14px;\"}\n\n## 5. Visual Correlation Analysis\n\n### 5.1 Overview\n\nThe correlation coefficient is a widely used statistic for measuring the type and strength of the relationship between two variables. It ranges from -1.0 to 1.0, where 1.0 indicates a perfect positive linear relationship, -1.0 signifies a perfect inverse relationship, and 0.0 represents no linear correlation.\n\nWhen dealing with multivariate data, the correlation coefficients for all variable pairs are typically presented in a correlation matrix or scatterplot matrix.\n\nA correlation matrix is computed for three main reasons:\n\n-   **Understanding Relationships** – It helps reveal pairwise relationships between high-dimensional variables.\n-   **Input for Further Analysis** – It serves as an input for techniques like exploratory and confirmatory factor analysis, structural equation modeling, and linear regression (especially when handling missing values pairwise).\n-   **Diagnostic Tool** – It aids in assessing other analyses, such as detecting multicollinearity in linear regression, which can affect the reliability of estimates.\n\nFor large datasets with many observations and variables, a [corrgram](https://www.datavis.ca/papers/vita/Friendly02corrgram.html) is often used to visually explore relationships and patterns. It is designed with two key principles:\n\n-   **Visual Representation** – Correlations are depicted based on their sign and magnitude.\n-   **Variable Reordering** – Similar variables are positioned adjacently in the correlation matrix to enhance pattern recognition.\n\nIn this hands-on exercise, we will learn data visualization for correlation matrices in R, covering three key sections:\n\n-   **Creating a Correlation Matrix** – Using the [`pairs()`](https://www.rdocumentation.org/packages/graphics/versions/3.6.0/topics/pairs) function from R Graphics.\n-   **Plotting a Corrgram** – Utilizing the [`corrplot`](https://www.rdocumentation.org/packages/corrplot/versions/0.95/topics/corrplot) package.\n-   **Building an Interactive Correlation Matrix** – Implementing [`plotly`](https://www.rdocumentation.org/packages/plotly/versions/4.10.4) in R.\n\n### 5.2 Installing and launching R packages\n\nWe will use the following code chunk in RStudio to install and load the required packages: [corrplot](https://www.rdocumentation.org/packages/corrplot/versions/0.95/topics/corrplot), [ggpubr](https://www.rdocumentation.org/packages/ggpubr/versions/0.6.0), [plotly](https://www.rdocumentation.org/packages/plotly/versions/4.10.4), and [tidyverse](https://www.rdocumentation.org/packages/tidyverse/versions/2.0.0) for data visualization and analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(corrplot, ggstatsplot, tidyverse)\n```\n:::\n\n\n\n### 5.3 Importing and preparing The Data Set\n\nIn this exercise, we will use the [Wine Quality Dataset](https://archive.ics.uci.edu/dataset/186/wine+quality) from the UCI Machine Learning Repository, which contains 13 variables and 6,497 observations. The dataset combines both red and white wine data into a single CSV file named wine_quality.\n\n#### 5.3.1 Importing the data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwine <- read_csv(\"data/wine_quality.csv\")\n```\n:::\n\n\n\nWe will check the dataset using below\n\n-   `glimpse()`: provides a transposed overview of a dataset, showing variables and their types in a concise format.\n-   `head()`: displays the first few rows of a dataset (default is 6 rows) to give a quick preview of the data.\n-   `summary()`: generates a statistical summary of each variable, including measures like mean, median, and range for numeric data.\n-   `duplicated()`:returns a logical vector indicating which elements or rows in a vector or data frame are duplicates.\n-   `Sum(is.na())`: counts the number of missing values (NA) in each column of the data frame.\n-   `spec()`: use `spec()` to quickly inspect the column\n\n::: panel-tabset\n## glimpse()\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(wine)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 6,497\nColumns: 13\n$ `fixed acidity`        <dbl> 7.4, 7.8, 7.8, 11.2, 7.4, 7.4, 7.9, 7.3, 7.8, 7…\n$ `volatile acidity`     <dbl> 0.700, 0.880, 0.760, 0.280, 0.700, 0.660, 0.600…\n$ `citric acid`          <dbl> 0.00, 0.00, 0.04, 0.56, 0.00, 0.00, 0.06, 0.00,…\n$ `residual sugar`       <dbl> 1.9, 2.6, 2.3, 1.9, 1.9, 1.8, 1.6, 1.2, 2.0, 6.…\n$ chlorides              <dbl> 0.076, 0.098, 0.092, 0.075, 0.076, 0.075, 0.069…\n$ `free sulfur dioxide`  <dbl> 11, 25, 15, 17, 11, 13, 15, 15, 9, 17, 15, 17, …\n$ `total sulfur dioxide` <dbl> 34, 67, 54, 60, 34, 40, 59, 21, 18, 102, 65, 10…\n$ density                <dbl> 0.9978, 0.9968, 0.9970, 0.9980, 0.9978, 0.9978,…\n$ pH                     <dbl> 3.51, 3.20, 3.26, 3.16, 3.51, 3.51, 3.30, 3.39,…\n$ sulphates              <dbl> 0.56, 0.68, 0.65, 0.58, 0.56, 0.56, 0.46, 0.47,…\n$ alcohol                <dbl> 9.4, 9.8, 9.8, 9.8, 9.4, 9.4, 9.4, 10.0, 9.5, 1…\n$ quality                <dbl> 5, 5, 5, 6, 5, 5, 5, 7, 7, 5, 5, 5, 5, 5, 5, 5,…\n$ type                   <chr> \"red\", \"red\", \"red\", \"red\", \"red\", \"red\", \"red\"…\n```\n\n\n:::\n:::\n\n\n\n## head()\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(wine)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 13\n  `fixed acidity` `volatile acidity` `citric acid` `residual sugar` chlorides\n            <dbl>              <dbl>         <dbl>            <dbl>     <dbl>\n1             7.4               0.7           0                 1.9     0.076\n2             7.8               0.88          0                 2.6     0.098\n3             7.8               0.76          0.04              2.3     0.092\n4            11.2               0.28          0.56              1.9     0.075\n5             7.4               0.7           0                 1.9     0.076\n6             7.4               0.66          0                 1.8     0.075\n# ℹ 8 more variables: `free sulfur dioxide` <dbl>,\n#   `total sulfur dioxide` <dbl>, density <dbl>, pH <dbl>, sulphates <dbl>,\n#   alcohol <dbl>, quality <dbl>, type <chr>\n```\n\n\n:::\n:::\n\n\n\n## summary()\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(wine)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n fixed acidity    volatile acidity  citric acid     residual sugar  \n Min.   : 3.800   Min.   :0.0800   Min.   :0.0000   Min.   : 0.600  \n 1st Qu.: 6.400   1st Qu.:0.2300   1st Qu.:0.2500   1st Qu.: 1.800  \n Median : 7.000   Median :0.2900   Median :0.3100   Median : 3.000  \n Mean   : 7.215   Mean   :0.3397   Mean   :0.3186   Mean   : 5.443  \n 3rd Qu.: 7.700   3rd Qu.:0.4000   3rd Qu.:0.3900   3rd Qu.: 8.100  \n Max.   :15.900   Max.   :1.5800   Max.   :1.6600   Max.   :65.800  \n   chlorides       free sulfur dioxide total sulfur dioxide    density      \n Min.   :0.00900   Min.   :  1.00      Min.   :  6.0        Min.   :0.9871  \n 1st Qu.:0.03800   1st Qu.: 17.00      1st Qu.: 77.0        1st Qu.:0.9923  \n Median :0.04700   Median : 29.00      Median :118.0        Median :0.9949  \n Mean   :0.05603   Mean   : 30.53      Mean   :115.7        Mean   :0.9947  \n 3rd Qu.:0.06500   3rd Qu.: 41.00      3rd Qu.:156.0        3rd Qu.:0.9970  \n Max.   :0.61100   Max.   :289.00      Max.   :440.0        Max.   :1.0390  \n       pH          sulphates         alcohol         quality     \n Min.   :2.720   Min.   :0.2200   Min.   : 8.00   Min.   :3.000  \n 1st Qu.:3.110   1st Qu.:0.4300   1st Qu.: 9.50   1st Qu.:5.000  \n Median :3.210   Median :0.5100   Median :10.30   Median :6.000  \n Mean   :3.219   Mean   :0.5313   Mean   :10.49   Mean   :5.818  \n 3rd Qu.:3.320   3rd Qu.:0.6000   3rd Qu.:11.30   3rd Qu.:6.000  \n Max.   :4.010   Max.   :2.0000   Max.   :14.90   Max.   :9.000  \n     type          \n Length:6497       \n Class :character  \n Mode  :character  \n                   \n                   \n                   \n```\n\n\n:::\n:::\n\n\n\n## duplicated()\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwine[duplicated(wine),]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1,177 × 13\n   `fixed acidity` `volatile acidity` `citric acid` `residual sugar` chlorides\n             <dbl>              <dbl>         <dbl>            <dbl>     <dbl>\n 1             7.4              0.7            0                1.9      0.076\n 2             7.5              0.5            0.36             6.1      0.071\n 3             7.9              0.43           0.21             1.6      0.106\n 4             7.3              0.45           0.36             5.9      0.074\n 5             7.2              0.725          0.05             4.65     0.086\n 6             8.8              0.41           0.64             2.2      0.093\n 7             8.6              0.49           0.28             1.9      0.11 \n 8             7.7              0.49           0.26             1.9      0.062\n 9             8.1              0.545          0.18             1.9      0.08 \n10             8.1              0.575          0.22             2.1      0.077\n# ℹ 1,167 more rows\n# ℹ 8 more variables: `free sulfur dioxide` <dbl>,\n#   `total sulfur dioxide` <dbl>, density <dbl>, pH <dbl>, sulphates <dbl>,\n#   alcohol <dbl>, quality <dbl>, type <chr>\n```\n\n\n:::\n:::\n\n\n\n## colSum(is.na(*dataset*))\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(is.na(wine))  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nspec(wine)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ncols(\n  `fixed acidity` = col_double(),\n  `volatile acidity` = col_double(),\n  `citric acid` = col_double(),\n  `residual sugar` = col_double(),\n  chlorides = col_double(),\n  `free sulfur dioxide` = col_double(),\n  `total sulfur dioxide` = col_double(),\n  density = col_double(),\n  pH = col_double(),\n  sulphates = col_double(),\n  alcohol = col_double(),\n  quality = col_double(),\n  type = col_character()\n)\n```\n\n\n:::\n:::\n\n\n:::\n\nThe wine tibble contains 13 attributes, as shown above:\n\n-   **Categorical attributes:** quality, type\n\n-   **Continuous attributes:** fixed acidity volatile acidity citric acid residual sugar chlorides free sulfur dioxide total sulfur dioxide density pH sulphates alcohol\n\n### 5.4 Building correlation matrix: `pairs()` method\n\nR offers multiple ways to create a scatterplot matrix. In this section, we will use the pairs() function from R Graphics to build a correlation matrix.\n\nBefore proceeding, we will review and read the syntax description of the [`pairs()`](https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/pairs.html) function.\n\n#### 5.4.1 Building a basic correlation matrix\n\nFigure below shows the scatter plot matrix of [Wine Quality Data](https://archive.ics.uci.edu/dataset/186/wine+quality). It is a 11 by 11 matrix.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(wine[,1:11])\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\nThe `pairs()` function in R requires a matrix or data frame as input.\n\nTo create a scatterplot matrix, a simple code chunk is used with the default `pairs()` function.\n\nIn the below code, columns 2 to 12 of the wine data frame are selected, including variables such as fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, density, pH, sulphates, and alcohol.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(wine[,2:12])\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n#### 5.4.2 Drawing the lower corner\n\nThe `pairs()` function in R Graphics offers various customization options. Since a correlation matrix is symmetric, it is common to display only the upper or lower half.\n\nTo show the lower half, the upper.panel argument is used, as demonstrated in the following code chunk.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(wine[,2:12], upper.panel = NULL)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\nTo show the upper half, the lower.panel argument is used, as demonstrated in the following code chunk.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(wine[,2:12], lower.panel = NULL)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n#### 5.4.3 Including with correlation coefficients\n\nTo display correlation coefficients instead of scatter plots, the [panel.cor](https://www.rdocumentation.org/packages/xcms/versions/1.48.0/topics/panel.cor) function is used, with higher correlations shown in a larger font.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npanel.cor <- function(x, y, digits=2, prefix=\"\", cex.cor, ...) {\nusr <- par(\"usr\")\non.exit(par(usr))\npar(usr = c(0, 1, 0, 1))\nr <- abs(cor(x, y, use=\"complete.obs\"))\ntxt <- format(c(r, 0.123456789), digits=digits)[1]\ntxt <- paste(prefix, txt, sep=\"\")\nif(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)\ntext(0.5, 0.5, txt, cex = cex.cor * (1 + r) / 2)\n}\n\npairs(wine[,2:12], \n      upper.panel = panel.cor)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n### 5.5 Visualising Correlation Matrix: [`ggcormat()`](https://indrajeetpatil.github.io/ggstatsplot/reference/ggcorrmat.html)\n\nA key limitation of the correlation matrix is that scatterplots become cluttered when the dataset is large (over 500 observations). To address this, the Corrgram visualization technique, proposed by [Murdoch & Chow (1996) and Friendly (2002)](https://cran.r-project.org/web/packages/corrplot/corrplot.pdf), will be used.\n\nThere are at least three R packages - [corrgram](https://cran.r-project.org/web/packages/corrgram/), - [ellipse](https://cran.r-project.org/web/packages/ellipse/), and - [corrplot](https://cran.r-project.org/web/packages/corrplot/)\n\nwhich offer functions to plot corrgrams.\n\nAdditionally, packages like [ggstatsplot](https://indrajeetpatil.github.io/ggstatsplot/reference/ggcorrmat.html) include functions for building corrgrams.\n\nIn the below section, we will learn how to visualize a correlation matrix using the [`ggcorrmat()`](https://indrajeetpatil.github.io/ggstatsplot/reference/ggcorrmat.html) function from the [ggstatsplot](https://indrajeetpatil.github.io/ggstatsplot/index.html) package.\n\n#### 5.5.1 The basic plot\n\nA key advantage of using *ggcorrmat()* over other methods for visualizing a correlation matrix is its ability to generate a comprehensive and professional statistical report, enhancing clarity and interpretability.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggstatsplot::ggcorrmat(\n  data = wine, \n  cor.vars = 1:11)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggstatsplot::ggcorrmat(\n  data = wine, \n  cor.vars = 1:11,\n  ggcorrplot.args = list(outline.color = \"black\", \n                         hc.order = TRUE,\n                         tl.cex = 10),\n  title    = \"Correlogram for wine dataset\",\n  subtitle = \"Four pairs are no significant at p < 0.05\"\n)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\nSome of the key takeaways from the code above: - `cor.vars` – Defines the variables for computing the correlation matrix in the corrgram. - `ggcorrplot.args` – Adds aesthetic customizations for `ggcorrplot::ggcorrplot`, excluding internally used arguments like `corr`, `method`, `p.mat`, `sig.level`, `ggtheme`, `colors`, `lab`, `pch`, `legend.title`, and `digits`.\n\nA sample sub-code chunk below can be used to customize specific plot components, such as font size for the x-axis, y-axis, and statistical report.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot.component = list(\n    theme(text=element_text(size=5),\n      axis.text.x = element_text(size = 8),\n      axis.text.y = element_text(size = 8)))\n```\n:::\n\n\n\n### 6.6 Building multiple plots\n\nSince ggstatsplot extends ggplot2, it supports faceting. However, faceting is not available in *ggcorrmat()* but is supported in [*grouped_ggcorrmat()*](https://indrajeetpatil.github.io/ggstatsplot/reference/grouped_ggcorrmat.html) from **ggstatsplot**.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrouped_ggcorrmat(\n  data = wine,\n  cor.vars = 1:11,\n  grouping.var = type,\n  type = \"robust\",\n  p.adjust.method = \"holm\",\n  plotgrid.args = list(ncol = 2),\n\n  # Optimizing appearance for clarity\n  ggcorrplot.args = list(\n    outline.color = \"black\",\n    hc.order = TRUE,\n    tl.cex = 5,   # Adjust text size to prevent overlap\n    tl.srt = 45,  # Rotate text for better alignment\n    lab_size = 1  # Adjust label size for better readability (without lab=TRUE)\n  ),\n\n  # Improving annotation clarity\n  annotation.args = list(\n    tag_levels = \"a\",\n    title = \"Correlogram for Wine Dataset\",\n    subtitle = \"Correlation between key chemical properties of red and white wines\",\n    caption = \"Dataset: UCI Machine Learning Repository\"\n  )\n)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\nSome of the key takeaways from the code above: - `grouping.var` – The only required argument to create a facet plot in `grouped_ggcorrmat()`. - [Patchwork](https://www.rdocumentation.org/packages/patchwork/versions/0.0.1) Package – Used behind the scenes for multi-plot layouts. - `plotgrid.args` – Passes additional arguments to [`patchwork::wrap_plots`](https://patchwork.data-imaginist.com/reference/wrap_plots.html), except for `guides`, which is set separately. - `annotation.args` – Specifies [plot annotation](https://patchwork.data-imaginist.com/reference/plot_annotation.html) arguments from the patchwork package.\n\n### 6.7 Visualising correlation matrix using [corrplot](https://www.rdocumentation.org/packages/corrplot/versions/0.95/topics/corrplot) package\n\nWe read on the review [\"An Introduction to corrplot Package\"](https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html) to gain a basic understanding of corrplot package.\n\n#### 6.7.1 Getting started with corrplot\n\nBefore using corrplot() to create a corrgram, the correlation matrix of the wine data frame must be computed. This is done using the [`cor()`](https://www.rdocumentation.org/packages/stats/versions/3.6.0/topics/cor) function from R Stats, as shown in the code chunk below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwine.cor <- cor(wine[, 1:11])\n```\n:::\n\n\n\nThe [`corrplot()`](https://www.rdocumentation.org/packages/corrplot/versions/0.2-0/topics/corrplot) function is then used to plot the corrgram with its default settings, as shown in the code chunk below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\nBy default, `corrplot()` uses **circles** for visualization and a **symmetric matrix layout**. The color scheme is **blue-red**, where:\n\n-   *Blue* represents *positive correlations*, and *red* represents *negative correlations*.\n-   *Color intensity (saturation)* indicates *correlation strength* — darker colors show stronger relationships, while lighter colors indicate weaker correlations.\n\n#### 6.7.2 Working with visual geometrics\n\nThe **corrplot** package offers seven visualization methods (method parameter) to represent correlation values: circle (default), square, ellipse, number, shade, color, and pie.\n\nThe default circle representation can be modified using the method argument, as demonstrated in the code chunk below.\n\n::: panel-tabset\n## ellipse\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"ellipse\") \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n## square\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"square\") \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n## number\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"number\") \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n## shade\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"shade\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n## color\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"color\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n## pie\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"pie\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n:::\n\n#### 6.7.3 Working with layout\n\n`corrplot()` supports three layout types: \"full\" (default), \"upper\", and \"lower\".\n\nThe default full matrix display can be modified using the type argument.\n\n::: panel-tabset\n## lower\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"ellipse\", \n         type=\"lower\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n\n## upper\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"square\", \n         type=\"upper\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\n## full\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"pie\", \n         type=\"full\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\n:::\n\nThe corrgram layout can be further customized. For example:\n\n-   `diag = FALSE` - removes diagonal cells.\n-   `tl.col = \"black\"` - changes axis text labels to black.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"ellipse\", \n         type=\"lower\",\n         diag = FALSE,\n         tl.col = \"black\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n\nFurther exploration:\n\n::: panel-tabset\n## tl.pos\n\n-   `tl.pos` - Position of the text labels\n-   it must be one of `lt`, `ld`, `td`, `d`, `l` or `n`.\n    -   `lt`(default if type=`full`) means left and top,\n    -   `ld`(default if type=`lower`) means left and diagonal\n    -   `td`(default if type=`upper`) means top and diagonal(near)\n    -   `d` means diagonal, `l` means left,\n    -   `n` means don’t add text-label.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"number\", \n         type=\"lower\",\n         diag = FALSE,\n         tl.pos = \"lt\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\n\n## tl.cex\n\n-   `tl.cex` - size of text label (variable names).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"square\", \n         type=\"lower\",\n         diag = FALSE,\n         tl.cex = 1)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n\n## tl.offset\n\nModifies text label spacing\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"ellipse\", \n         type=\"lower\",\n         diag = FALSE,\n         tl.offset = 2)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n\n## tl.srt\n\n-   `tl.cex` - text label string rotation in degrees.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"ellipse\", \n         type=\"upper\",\n         diag = FALSE,\n         tl.srt = 45 )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n\n## cl.pos\n\n-   `cl.pos` - Moves the color legend, in this case, it is \"b\" - bottom\n-   Other options include\n    -   \"r\" : right (default)\n    -   \"b\" : bottom\n    -   \"t\" : top\n    -   \"n\" : none\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"pie\", \n         type=\"upper\",\n         diag = FALSE,\n         cl.pos = \"b\" )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\n\n## cl.cex\n\n-   `cl.cex`- Adjusts color legend text size\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"color\", \n         type=\"upper\",\n         diag = FALSE,\n         cl.cex = 2 )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n\n## cl.offset\n\n-   `cl.offset`- Adjusts color legend positioning\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"shade\", \n         type=\"upper\",\n         diag = FALSE,\n         cl.offset = 0.5 )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n:::\n\n#### 6.7.4 Working with mixed layout\n\nThe **corrplot** package allows creating a mixed corrgram, where one half displays a visual matrix and the other half shows numerical values. This is achieved using [corrplot.mixed()](https://www.rdocumentation.org/packages/corrplot/versions/0.84/topics/corrplot.mixed), a specialized function for mixed visualization styles.\n\nFigure below shows a mixed layout corrgram plotted using wine quality data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot.mixed(wine.cor, \n               lower = \"shade\", \n               upper = \"number\",\n               tl.pos = \"lt\",\n               diag = \"l\",\n               tl.col = \"green\",\n               tl.srt = 45)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot.mixed(wine.cor, \n               lower = \"circle\", \n               upper = \"square\",\n               tl.pos = \"lt\",\n               diag = \"l\",\n               tl.col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n\n\nIn `corrplot.mixed()`, the arguments `lower` and `upper` define the visualization methods for each half of the **corrgram** (e.g., circles for the lower half and squares for the upper half).\n\n-   `tl.pos` : controls the placement of axis labels.\n-   `diag` : specifies the glyph style on the diagonal of the corrgram.\n\n#### 6.7.5 Combining corrgram with the significant test\n\nIn statistical analysis, it's important to determine which variable pairs have statistically significant correlations.\n\nThe corrgram with significance testing reveals that not all correlations are significant. For example:\n\n-   The correlation between total sulfur dioxide and free sulfur dioxide is significant at a 0.1 level.\n\n-   However, the correlation between total sulfur dioxide and citric acid is not statistically significant.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n\n\nWe can use the *cor.mtest()* to compute the p-values and confidence interval for each pair of variables.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwine.sig = cor.mtest(wine.cor, conf.level= .95)\n```\n:::\n\n\n\nWe can then use the *p.mat* argument of *corrplot* function as shown in the code below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor,\n         method = \"number\",\n         type = \"lower\",\n         diag = FALSE,\n         tl.col = \"black\",\n         tl.srt = 45,\n         p.mat = wine.sig$p,\n         sig.level = .05)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\n\n\n#### 6.7.6 Reorder a corrgram\n\nMatrix reordering is crucial for uncovering hidden structures and patterns in a corrgram. By default, attributes are sorted based on the original correlation matrix, but this can be changed using the order argument in *corrplot()*.\n\nSupported Sorting Methods in corrplot():\n\n-   \"AOE\" – Angular order of eigenvectors (Michael Friendly, 2002).\n-   \"FPC\" – First principal component order.\n-   \"hclust\" – Hierarchical clustering order (customizable with hclust.method).\n    -   Supported agglomeration methods: \"ward\", \"single\", \"complete\", \"average\", \"mcquitty\", \"median\", \"centroid\".\n-   \"alphabet\" – Alphabetical order. Additional ordering algorithms are available in the \\[seriation\\](<https://www.rdocumentation.org/packages/seriation/versions/1.4.1>) package.\n\n::: panel-tabset\n## AOE\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot.mixed(wine.cor, \n               lower = \"shade\", \n               upper = \"number\",\n               tl.pos = \"lt\",\n               diag = \"l\",\n               order=\"AOE\",\n               tl.col = \"black\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\n\n## FPC\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot.mixed(wine.cor, \n               lower = \"ellipse\", \n               upper = \"number\",\n               tl.pos = \"lt\",\n               diag = \"l\",\n               order=\"FPC\",\n               tl.col = \"blue\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\n\n## hclust\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"ellipse\", \n         tl.pos = \"lt\",\n         tl.col = \"purple\",\n         order=\"hclust\",\n         hclust.method = \"centroid\",\n         addrect = 5)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\n\n## alphabet\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot.mixed(wine.cor, \n               lower = \"circle\", \n               upper = \"number\",\n               tl.pos = \"lt\",\n               diag = \"l\",\n               order=\"alphabet\",\n               tl.col = \"pink\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\n:::\n\n#### 6.7.7 Reordering a correlation matrix using hclust\n\nWhen using `hclust` in [corrplot()](https://www.rdocumentation.org/packages/corrplot/versions/0.95/topics/corrplot), hierarchical clustering can be applied to group similar variables, and rectangles can be drawn around clusters in the corrgram to highlight these groupings.\n\nThere are seven supported methods:\n\n| Method | Description | Strengths | Weaknesses |\n|------------------|------------------|------------------|------------------|\n| ward.D / ward.D2 | Minimizes variance | Compact, balanced clusters | Sensitive to outliers |\n| single | Merges based on closest points | Can handle noisy data | Creates elongated chains |\n| complete | Merges based on farthest points | Well-separated clusters | Can over-separate data |\n| average | Uses average distances | Good balance of compactness & separation | Can struggle with noisy data |\n| mcquitty | Weighted version of average | Less computationally expensive | Less balanced clusters |\n| median | Uses median distances | Handles outliers well | Less commonly used |\n| centroid | Uses centroid of clusters | Computationally efficient | Can create inconsistent results |\n\n::: panel-tabset\n## ward.D\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"ellipse\", \n         tl.pos = \"lt\",\n         tl.col = \"black\",\n         order=\"hclust\",\n         hclust.method = \"ward.D\",\n         addrect = 3)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n\n\n## single\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"number\", \n         tl.pos = \"lt\",\n         tl.col = \"black\",\n         order = \"hclust\",\n         hclust.method = \"single\",\n         addrect = 4) \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n\n\n## complete\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"ellipse\", \n         tl.pos = \"t\",\n         tl.col = \"blue\",\n         order = \"hclust\",\n         hclust.method = \"complete\",\n         addrect = 6)  \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n\n\n## average\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"shade\", \n         tl.pos = \"lt\",\n         tl.col = \"black\",\n         order=\"hclust\",\n         hclust.method = \"average\",\n         addrect = 8)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-49-1.png){width=672}\n:::\n:::\n\n\n\n## mcquitty\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"shade\", \n         tl.pos = \"lt\",\n         tl.col = \"black\",\n         order=\"hclust\",\n         hclust.method = \"mcquitty\",\n         addrect = 6)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n:::\n\n\n\n## median\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"square\", \n         tl.pos = \"n\",  \n         order = \"hclust\",\n         hclust.method = \"median\",\n         addrect = 5, \n         cl.pos = \"b\")  \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-51-1.png){width=672}\n:::\n:::\n\n\n\n## centroid\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(wine.cor, \n         method = \"color\", \n         tl.pos = \"d\", \n         tl.col = \"red\",\n         order = \"hclust\",\n         hclust.method = \"centroid\",\n         addrect = 7)  # Draw 7 clusters\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex05b_files/figure-html/unnamed-chunk-52-1.png){width=672}\n:::\n:::\n\n\n:::\n\n### 6.8 References\n\n-   Kam, T.S(2024). [Visual Statistical Analysis.](https://r4va.netlify.app/chap06)\n\n### 6.9 Takeaway\n\n::: callout-tip\n## Key takeaways\n\n-   Learnt to use `ggcorrmat()` for clean, report-friendly visualizations.\n-   Learnt to use `corrplot()` for more customization and clustering insights.\n-   Reordering methods help detect hidden structures in correlation matrices.\n-   Significance testing is crucial to avoid misleading interpretations.\n\n## R functions for correlation analysis\n\n| Functions               | Purpose                                    |\n|-------------------------|--------------------------------------------|\n| `pairs()`               | Scatterplot matrix                         |\n| `ggcorrmat()`           | Statistical correlogram                    |\n| `grouped_ggcorrmat()`   | Faceted correlogram                        |\n| `corrplot()`            | Highly customizable correlation matrix     |\n| `corrplot.mixed()`      | Mixed visual/numerical correlation matrix  |\n| `cor.mtest()`           | Computes p-values for significance testing |\n| `order` in `corrplot()` | Reorders matrix based on structure         |\n:::\n\n### 7.0 Further exploration\n\n\n\n",
    "supporting": [
      "Hands-on_Ex05b_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}